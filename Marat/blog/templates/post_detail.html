{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{{ post.title }} — {{ post.club.name }}{% endblock %}

{% block content %}
<div class="post-detail">

    <!-- Пост -->
    <article>
        <h1>{{ post.title }}</h1>
        <p class="meta">
            <small>
                Автор: <strong>{{ post.author }}</strong> |
                {{ post.date_posted|date:"d.m.Y H:i" }} |
                Клуб: {{ post.club.name }}
            </small>
        </p>

        <div class="post-content">
            {{ post.content|linebreaks }}
        </div>
    </article>

    <!-- Комментарии -->
    <section class="comments-section">
        <h2>
            {% blocktrans count counter=comments.count %}
                Комментарий ({{ counter }})
            {% plural %}
                Комментарии ({{ counter }})
            {% endblocktrans %}
        </h2>

        {% for comment in comments %}
            <div class="comment">
                <div class="comment-header">
                    <strong>{{ comment.subject }}</strong>
                    <span class="comment-meta">
                        — {{ comment.author.username }} |
                        {{ comment.created_at|date:"d.m.Y H:i" }}
                    </span>
                </div>
                <div class="comment-body">
                    {{ comment.text|linebreaks }}
                </div>
            </div>
        {% empty %}
            <p class="no-comments">
                <em>{% trans "Пока нет комментариев. Будьте первым!" %}</em>
            </p>
        {% endfor %}
    </section>

    <!-- Форма комментария -->
    {% if user.is_authenticated %}
        <section class="comment-form-section">
            <h2>{% trans "Оставить комментарий" %}</h2>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert success">{{ message }}</div>
                {% endfor %}
            {% endif %}

            <form method="post" class="comment-form">
                {% csrf_token %}

                <div class="form-group">
                    <label for="{{ form.subject.id_for_label }}">{% trans "Тема" %} *</label>
                    {{ form.subject }}
                    {% if form.subject.errors %}
                        <small class="error">{{ form.subject.errors|join:", " }}</small>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.text.id_for_label }}">{% trans "Комментарий" %} *</label>
                    {{ form.text }}
                    {% if form.text.errors %}
                        <small class="error">{{ form.text.errors|join:", " }}</small>
                    {% endif %}
                </div>

                <button type="submit" class="btn">{% trans "Отправить комментарий" %}</button>
            </form>
        </section>

    {% else %}
        <div class="login-prompt">
            <p>
                {% trans "Чтобы оставить комментарий" %},
                <a href="{% url 'login' %}?next={{ request.path }}">{% trans "войдите" %}</a>
                {% trans "или" %}
                <a href="{% url 'register' %}">{% trans "зарегистрируйтесь" %}</a>.
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}
